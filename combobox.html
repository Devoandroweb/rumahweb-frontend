<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Combobox Tailwind (Headless-like) — HTML + JS</title>
  <!-- Tailwind Play CDN (untuk prototyping). Untuk produksi, build Tailwind lewat npm/postcss agar lebih optimal -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Sedikit style tambahan untuk scroll dan transition */
    .combo-list { max-height: 220px; }
  </style>
</head>
<body class="bg-slate-100 min-h-screen flex items-start justify-center p-8">

  <div id="combo-root" class="w-full max-w-md">
    <label id="combo-label" for="combo-input" class="block text-sm text-slate-600 mb-2">Pilih Negara</label>

    <div class="relative">
      <div id="combobox" role="combobox" aria-haspopup="listbox" aria-expanded="false" aria-owns="combo-list" class="flex items-center gap-2 bg-white border border-slate-200 rounded-lg p-2 shadow-sm focus-within:ring-2 focus-within:ring-indigo-300">
        <input id="combo-input" class="flex-1 text-sm outline-none bg-transparent placeholder:text-slate-400" type="text" aria-autocomplete="list" aria-controls="combo-list" autocomplete="off" placeholder="Mulai ketik atau pilih..." />
        <button id="clear-btn" aria-label="Bersihkan" title="Bersihkan" class="hidden text-slate-500 hover:text-slate-700 p-1 rounded" type="button">✕</button>
        <button id="toggle-btn" aria-label="Tampilkan opsi" title="Tampilkan opsi" class="text-slate-500 hover:text-slate-700 p-1 rounded" type="button">▾</button>
      </div>

      <div id="combo-list" class="combo-list absolute z-50 left-0 right-0 mt-2 bg-white border border-slate-200 rounded-lg shadow-lg overflow-auto hidden" role="listbox" tabindex="-1" aria-labelledby="combo-label">
        <!-- options akan di-render lewat JS -->
      </div>
    </div>
  </div>

<script>
(function(){
  // sample data
  const items = [
    { id: 'id', label: 'Indonesia', meta: 'Asia' },
    { id: 'sg', label: 'Singapore', meta: 'Asia' },
    { id: 'my', label: 'Malaysia', meta: 'Asia' },
    { id: 'th', label: 'Thailand', meta: 'Asia' },
    { id: 'ph', label: 'Philippines', meta: 'Asia' },
    { id: 'us', label: 'United States', meta: 'Americas' },
    { id: 'gb', label: 'United Kingdom', meta: 'Europe' },
    { id: 'de', label: 'Germany', meta: 'Europe' },
    { id: 'jp', label: 'Japan', meta: 'Asia' },
    { id: 'au', label: 'Australia', meta: 'Oceania' },
  ];

  // refs
  const root = document.getElementById('combo-root');
  const combobox = document.getElementById('combobox');
  const input = document.getElementById('combo-input');
  const list = document.getElementById('combo-list');
  const clearBtn = document.getElementById('clear-btn');
  const toggleBtn = document.getElementById('toggle-btn');

  // state
  let open = false;
  let filtered = [...items];
  let activeIndex = -1; // index dalam filtered
  let value = null;

  function renderOptions(){
    list.innerHTML = '';
    if (filtered.length === 0) {
      const no = document.createElement('div');
      no.className = 'p-3 text-sm text-slate-500 text-center';
      no.textContent = 'Tidak ditemukan';
      list.appendChild(no);
      return;
    }

    filtered.forEach((it, idx) => {
      const el = document.createElement('div');
      el.setAttribute('role','option');
      el.id = `opt-${it.id}`;
      el.dataset.index = idx;
      el.className = 'p-2.5 flex justify-between items-center cursor-pointer rounded-md hover:bg-indigo-50';
      if (value && value.id === it.id) {
        el.classList.add('bg-indigo-50','font-semibold','text-indigo-600');
      }
      if (idx === activeIndex) {
        el.classList.add('ring-2','ring-indigo-200');
      }

      const left = document.createElement('div');
      left.className = 'text-sm';
      left.textContent = it.label;

      const right = document.createElement('div');
      right.className = 'text-xs text-slate-500';
      right.textContent = it.meta || '';

      el.appendChild(left);
      el.appendChild(right);

      el.addEventListener('mousedown', (e) => { e.preventDefault(); selectIndex(idx); });
      list.appendChild(el);
    });

    // update aria-activedescendant
    if (activeIndex >= 0 && filtered[activeIndex]) {
      input.setAttribute('aria-activedescendant', `opt-${filtered[activeIndex].id}`);
    } else {
      input.setAttribute('aria-activedescendant','');
    }
  }

  function openList(){
    if (open) return;
    open = true;
    list.classList.remove('hidden');
    combobox.setAttribute('aria-expanded','true');
    renderOptions();
  }
  function closeList(){
    if (!open) return;
    open = false;
    list.classList.add('hidden');
    combobox.setAttribute('aria-expanded','false');
    activeIndex = -1;
    input.setAttribute('aria-activedescendant','');
  }

  function selectIndex(i){
    const it = filtered[i];
    if (!it) return;
    value = it;
    input.value = it.label;
    input.setAttribute('data-value', it.id);
    clearBtn.classList.remove('hidden');
    closeList();
    root.dispatchEvent(new CustomEvent('combobox:select', { detail: it }));
  }

  function clearSelection(){
    value = null;
    input.value = '';
    input.removeAttribute('data-value');
    clearBtn.classList.add('hidden');
    filtered = [...items];
    renderOptions();
  }

  function filter(q){
    const qq = String(q||'').trim().toLowerCase();
    if (!qq) filtered = [...items];
    else filtered = items.filter(it => it.label.toLowerCase().includes(qq) || (it.meta && it.meta.toLowerCase().includes(qq)));
    activeIndex = filtered.length ? 0 : -1;
    renderOptions();
  }

  function scrollActiveIntoView(){
    requestAnimationFrame(() => {
      const active = list.querySelector('[data-index][id="opt-' + (filtered[activeIndex]?.id || '') + '"]');
      const el = list.querySelector('[data-index][data-index="' + activeIndex + '"]');
      if (!el) return;
      const listRect = list.getBoundingClientRect();
      const elRect = el.getBoundingClientRect();
      if (elRect.top < listRect.top) el.scrollIntoView({block:'nearest'});
      else if (elRect.bottom > listRect.bottom) el.scrollIntoView({block:'nearest'});
    });
  }

  // events
  input.addEventListener('input', (e) => { filter(e.target.value); openList(); clearBtn.classList.toggle('hidden', !e.target.value); });

  input.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowDown'){
      e.preventDefault(); if (!open) openList(); if (filtered.length) { activeIndex = (activeIndex + 1) % filtered.length; renderOptions(); scrollActiveIntoView(); }
    } else if (e.key === 'ArrowUp'){
      e.preventDefault(); if (!open) openList(); if (filtered.length) { activeIndex = (activeIndex - 1 + filtered.length) % filtered.length; renderOptions(); scrollActiveIntoView(); }
    } else if (e.key === 'Enter'){
      e.preventDefault(); if (open && activeIndex >= 0) selectIndex(activeIndex); else closeList();
    } else if (e.key === 'Escape'){
      if (open) { closeList(); e.preventDefault(); }
    } else if (e.key === 'Tab'){
      closeList();
    }
  });

  toggleBtn.addEventListener('click', () => { if (open) { closeList(); input.focus(); } else { openList(); input.focus(); } });
  clearBtn.addEventListener('click', () => { clearSelection(); input.focus(); });

  document.addEventListener('click', (e) => { if (!root.contains(e.target)) closeList(); });

  // init
  filtered = [...items];
  renderOptions();

  // expose helper
  root.getSelected = () => value;
  root.addEventListener('combobox:select', (ev) => console.log('Dipilih:', ev.detail));

})();
</script>

</body>
</html>
